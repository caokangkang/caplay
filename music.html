<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name='viewport' content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
	<script src="http://g.tbcdn.cn/mtb/lib-flexible/0.3.4/??flexible_css.js,flexible.js"></script>
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/base.css">
	<link rel="stylesheet" href="//at.alicdn.com/t/font_30sypawsi5krcnmi.css">
	<title>音乐</title>
</head>
<body>
	<div class="conainter">
		<div class="meta" id="meta">
			<div class="times">
				<img src="img/img_ckk/index/times.png" alt="">
			</div>
			<div class="back">
				<img src="img/img_ckk/index/back.png" alt="">
			</div>
		</div>
		<div class="index_content">
			<div id="map">
				<div class="voice_prompt" id="song_box">
					<div class="navigatetop clearfix">
						<p class="navitate_state song_back" style="color:#7ec9fc;font-size:20px;"> &lt; 返回</p>
						<p class="navitate_title"><span class="song_num">9</span>/<span class="song_list">9</span></p>
					</div>
					<div class="mapconTent">
						<div class="song_title">
							<p>Boby song</p>
						</div>
						<div class="singer">
							<p>陈奕迅</p>
						</div>
						<div class="song_btns">
						 	<div class="prev_music">
						 		<img src="img/music_ckk/prev_music.png">
						 	</div>
						 	<div class="pause">
						 		<i class="iconfont icon-kaishi2" id="play"></i>
						 	</div>
						 	<div class="next_music next_twe">
						 		<img src="img/music_ckk/next_music.png">
						 	</div>
						</div>
						<div class="song_time">
						 	<div class="song_start">
						 		<span>00:00</span>
						 	</div>
						 	<div class="song_pregress">
						 		<span class="progress"></span>
						 		<span class="progress_line"></span>
						 	</div>
						 	<div class="song_end">
						 		<span>-00:00</span>
						 	</div>
						</div>
						<!--歌曲循环方式-->
						<div class="recycle_design">
							<div class="recyclebox">
								<div class="random">
									<div>
										<p>
											<img src="img/music_ckk/random.png">
										</p>
									</div>
								</div>
								<div class="singlist">
									<div>
										<p>
											<img src="img/music_ckk/song_list.png">
										</p>										
									</div>
								</div>
								<div class="cycle">
									<div>
										<p>
											<img src="img/music_ckk/order.png">
										</p>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<audio controls="controls" name="media" id="audio"></audio>
	<script src="script/jquery-3.1.1.min.js"></script>
	<script type="text/javascript" src="script/data.js"></script>
	<script>
		var oMusic = document.getElementById("audio");//引擎标签
		var oPlay = document.getElementById("play");//播放标签
		var Stime = document.querySelector(".song_start span");//开始时间
		var Etime = document.querySelector(".song_end span");//总时间
		var oTotalProgress = document.querySelector(".progress")
		var oProgressDot = document.querySelector(".progress_line");//小圆点移动
		var bMark = true;
		var progress = null;
		var n = 0;

		var musicPlay = {
			init : function(){
				$(".song_title p").html(audio_list[n].title);
				$(".singer p").html(audio_list[n].singer);
				$("audio").attr("src" , audio_list[n].src);
			},
			play_function : function(){
				var This = this;
				oMusic.play();
				oPlay.className = "iconfont icon-kaishi1";
				//监听音乐时间
				oMusic.addEventListener('timeUpdate',function(){
					if(this.ended){
						n++;
						n %= musicData.length;
						oProgressDot.style.left = '0px';
						This.init();
						This.player_function();
						bMark = false;
					}
				})
				//显示当前时间
				setTimeOut(function(){
					//当前事件显示
					Stime[0].innerHTML = conversionTime(this.currentTime);
					Etime[0].innerHTML = conversionTime(this.duration);
					// 当前进度条 = 当前事件 / 总时间 * 总长度
					progress = this.currentTime / this.duration * oTotalProgress.offsetWidth + 'px';
					oProgressDot.style.left = parseFloat( progress )  + "px";
				},200)
			},
			init_player : function(){
				if( bMark == true ){
					musicPlay.player_function;
				}else{
					// 暂停
					oMusic.pause();
					oPlay.className = "iconfont icon-kaishi2";
				}
			},
			forWard : function(){
				var This = this;
				$(".prev_music")[0].onclick = function(){
					n--;
					if( n < 0 )n = musiData.length = -1;
					this.init();
					musicPlay.play_function();
					bMark = false;
				}
			},
			forWard : function(){
				var This = this;
				$(".next_music")[0].onclick = function(){
					n++;
					n %= musicData.length;
					This.init();
				}
			}
			exe : function(){
				this.init();

			}
		}

		function conversionTime( t ){
			var m = toTwo( Math.floor( t % 3600 / 60 ) );
			var s = toTwo( Math.floor( t % 60 ) );
			function toTwo(n){
				return n > 9 ? String(n) : '0' + n
			}
		}










		// function play_function(){
		// 	var This = 
		// }
		$(function(){
			// 返回播放别表
			$(".song_back").on("click",function(){
				location.href = "http://www.baidu.com";
			})

			// 点击播放


			//点击下一首按钮
			$(".next_music").on("click",function(){
				audio_url = $("audio").attr("src")
				var musiclength = audio_list.length
				nextPlay = toplaybox()
				console.log(nextPlay)
			})

			// 判断音频是否播放完毕
			$("audio").on("ended",function(){
				$(".pause").children().removeClass("icon-zanting1").addClass("icon-kaishi2")
				// $(".progress_line").css("left" , "0")
			})
		})

		function audioPlay(){
			var nextPlay;
			for(var i=0;i<musiclength;i++){
				if(audio_url = audio_list[i]){
					nextPlay = audio_list[i + 1];
				}
			}
			return nextPlay
		}

		// 显示播放界面方法
		function toplaybox(){
			$("#song_box").animate({
				left:"0",
			},400);
		}

		function audio(){
			setInterval(function(){
				audio_duration = $("audio").get(0).duration;
				now = $("audio").get(0).currentTime;
				// now = 100;
				nowTime = ( now/audio_duration )*($(".progress").width());
				$(".progress_line").css("left" , nowTime + 'px')
				currentM = parseInt(now/60)>9?""+parseInt(now/60):"0"+ parseInt(now/60);
				currents = parseInt(now)%60>9?""+parseInt(now)%60:"0"+ parseInt(now)%60;
				$(".song_start span").html(currentM + ":" +　currents)
				durationM = parseInt(audio_duration/60)>9?""+parseInt(audio_duration/60):"0"+ parseInt(audio_duration/60);
				durations = parseInt(audio_duration)%60>9?""+parseInt(audio_duration)%60:"0"+ parseInt(audio_duration)%60;
				$(".song_end span").html("-" + durationM+":"+ durations )
			},400)
		}

		function canplay(){
			console.log(1)
			document.getElementById("audio").addEventListener("onclick",function(){
				// console.log(2)
				$("audio").get(0).pause();
				$("audio").get(0).currentTime += 15;
				setTimeout(function(){
					$("audio").get(0).play();
				},100)
			})
		}
	</script>
</body>
</html>